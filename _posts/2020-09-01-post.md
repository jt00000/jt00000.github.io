---
layout: page
title: "9月まとめ"
date: 2020-09-01 00:00:00 -0000
---
### twctf2020
- pwn１とmisc１。pwn難しい。
    - nonologinだけできた。素直なheapガチャ系でがちゃったらできちゃった
    - smash: cetがついてる問題だけど、libcリークからshadowstackの位置がわかるんだけど書き換えれなくね
    - blindshot: 最近見たrbp壊してlibcアドレス書いてあるスタックを書き換えるやつを狙ったけど、rbpが一段足りない
        - printfで２段書き換え、なんか無理だと思ってたけど、最初の変更を`%??$hn`の形でやらなければ、２段で変更することができる。このとき課題は、スタックの下１６ビットがわからないこと。2^12ガチャと思いきや、作問者writeupはかなり天才な感じで、rbpの値を置いておいて、あとで４倍することで、現在の入力長の下１６ビットを１／４の確率で一致させて、リターンアドレスを書き換えられる。リークはサービス関数の引数を１に変えられるように文字数調整してstdoutに出す。あとは、この問題ならheapに入力が入るので、rbpにheapのアドレスをセットしてleave二回で飛ばす。入力が出すぎて時間が切れるのか、リークが終わったら再び３（/dev/null）にしているところもポイント。問題によってはstderrとかに吐かないといけないのもありそう。
    - vid: viの独自実装っぽいの。regexよくわからんかった
        - エラーでリーク、イテレータでrceとのこと。まずエラーがどっからつながってるかがわからない。構造体に仕込める？そうだとしても関数がつながってないし、ブレーク貼ってもjmpで来てるっぽくてどこから飛んできてるのかよくわからん。
            - これがinsertの中からthrow_out_of_rangeに投げられていて、これが呼ばれる前にスタック作り直すからbtが切れてしまう。これに該当するコードの部分がよくわからないんだけど、handleの下の方にそれっぽい処理があって、ghidraはここを通らないコードだと思っているから、デフォルトではデコンパイルしてないっぽい。
    - il: dotnet?か何かのやつこれはさっぱりわからなかった。動作はしてくれたけど。

### downunderctf2020
- pwnうしろ３問解けず。あとはメチャクチャ簡単だったっぽい
    - vecc: 普通のheap問、初期化してないのでリークは行って、書き換えのほうが少しだけ難しい。main_arenaを追加で書けるのでそのまま下の方まで書いてしまって、free_hookを変えればいいけど、途中のstdoutとかを壊すので、下記戻さないならsystemは使えなくて、execveにしないと動かない
    - zombie: rustの少し前にやってたやつ。解説見ても難しかったんだけど、生きてちゃダメな変数が生き続けるので〜みたいな設定。
    - pwn or web: chrome問。slice系をいじってそうだから少しやってみたけどやっぱり何やればいいのかわからんかった

### csawCTF2020
- pwnはgridだけ、あとはrevのbloxと、webのzwspのやつをといた。
    - pwnのgridはあんまり何も覚えてないけどマスの外側書けるのと、初手ディスプレイで全部リークするから何も考えずにスタック書き換えて１００回回した。
    - pwnのblox2は方針があってて、ブロックをめり込ませてheap_topを変えてaawするんだけど、その後がわからず。そもそも思い込みが激しすぎて進まなかった。チートモードは１回入れるとゲームオーバーになっても有効であること、名前入力を省略しても良いことが頭からすっかり抜けてたし、srand(1)をなんでか知らんが途中までsrand(time())だと思ってて、なかなか頭のコンディション悪そう。writeupはめちゃくちゃ天才だった。これ好きだなあ
        - ハイスコア判定の枠を5個になっているところを拡張
        - A~ZまでとなっているところのAのところを、”１文字入力して削除する”ことで一時的に\x01~Zにする。直後に続くjleをどうでもいい命令に変えてしまうことで文字制限を壊す
        - \x01~ZでZの方はjgの飛び先を手前に落としてこっちも壊す。これで\x01~\xffまで入力できる
        - 最後に文字数が３文字で制限されているところを伸ばす
        - 命令列が４の倍数から始まっているところまで適当に移動してシェルコードを入れる。
    - pwnのfeatherはヘッダ作ってセクション作ったら時間が切れた。

### alliesCTF2020
- ほぼ参加できず。触った一問だけ
    - nullptr: なんもわからんなーと思ってたらまたscanfのアレでリークということが復習中に発覚しだいぶ脳が弱っていることを確認した。まじでscanf見つけたら+を入れる活動、やっていかないとだめ。この後はstdinのwrite_baseからガチャする

### InterKosenCTF2020
- 珍しく事前登録の段階で気づけた。いつもどおり他のジャンルはよくわからないけどとりあえずpwnとrevは一通りできた（misc/pwnはわかりませんでした）
    - babysort: ソート選択で負数
    - authme: 一度目でropを作って2回めでstdinを切ってuserとpassを抜く。一番時間かかった。一度なぜかuserとpassを入力して上手く通ってなくて焦った。コピペミスかな
    - Fables of aeSOP: bssはリークされているのでIO_FILEとvtableを用意してファイルポインタを書き換える
    - confusing: JSCのdoubleでポインタ作るやつを模した問題。doubleでgotを指したりlistを指したりしてlibcとheapをリークしてfree_hookを書き換える。入力でもmallocは走っているので調整が必要で、free_hook-8に書き込んで解決した。
    - その他解けたもの
        - matsushima2: クッキーコピペして解いた。一回ミスがあってしんどかった。ネコアイコンがかわいい。
        - limited: CRT〜と思ったけど40文字くらいならと思って手計算した。
        - harmagedon: ビット操作真似てスクリプト作った
        - in question: スクリプトをくむ
        - trilemma: 存在したら落ちる方の条件分を全部削いで、ip動かして結果を取得
        - stratum: 出力を逆にたどってスクリプトへ。今回revはどれもとっつきやすかった。
- できなかった問題
    - pash: pwn全完が阻まれた。毎度少なくとも1問は厳しい問題が出てきて困ってるんだけど、今回はmisc的な意味で困った。具体的にはsshでコマンドを入れると、最初に立ち上がるスクリプトより優先的に実行されるのは知らなかった。
    - readme: これもmiscっぽいやつで、問題のスクリプト見た瞬間に諦めた。openしっぱなしになってるので、fdとしては保持していて、/proc/self/fd/xでアクセスできます、selfはだめだけど。という問題。procfsのマニュアル片手にガチャって覚えるというのがまっとうな攻略なんだなあ。
    - no pressure: RC4ってあまりしっかり見たことがなくて、何していいのかよくわかっていなかったけど、ストリーム暗号ってバイト単位でやってんのﾋｮｴｰってなってた。aescbcとかspeckとかの脳みそで見てたので、当然ブロック単位だとばかり思っていた。これはいいことを知れた。解説見た後の良問ランキング1位。

### GACTF復習
- 公式writeupは神（https://mp.weixin.qq.com/s/0cOsuIFJwHbHIYvluQq4WQ）
- student manager: IO_FILEのvtable改ざんは正解なんだけど、変えるのはstout。stderrを変えてassertを走らせる方針で考えていて、0x30サイズのmallocだけだとできないし、environリークからのピボットも考えたけど、この問題ではそもそも書き込まれない値のリークはできない。
    - fwriteからのvtable+0x38の呼び出しで、_IO_str_finishにつないで、vtable+0xe8を呼ばせる。このときrdiにはstudent nameが入っているので、8文字以内の任意の入力がsystemに入れられる。シングルクォートが入っているので`';sh`と入れれば良い。IO_FILEは難しい。
- feedback: 実はpwnの1問であり、感想文送るところではなかった。glibc2.23でfastbinを切ってあって、hookも消される。largebinを使うらしい。unsortedを2つ重ねて、片方を取り直すと、もう片方はlargebinへ吸い込まれる。（TODO：largeの判定は0x400以上？ソースの該当箇所）