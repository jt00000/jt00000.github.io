---
layout: page
title: "5月まとめ"
date: 2021-05-01 00:00:00 -0000
---
### seccon beginners 2021
- (5/22) pwnが全部解けた。普通に非自明のheap問とvm問が残って悲しんでたから、ちゃんと解き切れてとてもうれしい。
    - 結局revとpwnとパッと見てできるやつとをやって時間切れた。日曜日はパソコンをほぼ触っていないため、何位だったかはよくわからん。
    - 2021-emulator：えらい長いソースがついていて（vm問様式美）、落ち着いて見ると結局メモリを選んで書いてるところが一か所しかないので確認して、範囲チェックしてないのでheapの下方にある関数ポインタを触ってnopになってるコマンドをsystemに差し替える。第一引数はemu構造体になっていて、これは先頭がレジスタだから、レジスタに/bin/shの値をセットすればOK。面白かった。
    - freeless：二つuaf用のチャンクを作って一方をenvironリーク、他方をスタックallocに使ってreadlineでropした。
        - sysmallocではfreeが走らないという知見を得た。free_hookに書いてｶﾁｬｶﾁｬｯﾀｰﾝしても進まなくて発覚した。sysmallocのfree機能が複数回使えるのも知らなかったな。
    - web / jsonは二重のidを試していたが多分前後が逆だったんだろうなあ。web / werewolfは何が悪いのかわからなかった。結局オブジェクトは書き方があるらしい。あまり時間もなかったのであとは終わってしまった。

### 3kctf2021
- (5/15-16) 初のCTFホスト側に回って、特にノルマもなかったけどしばらく問題作りにいそしんでいた。運営側おもしろかったね。テストアカウントでフラグ入れて、点数が変動しちゃったりしてめっちゃびっくりしたけど。以下は作問の感想。
    - 作問用に時間取れるかなと思った時点で、他のメンバーはx86以外のアーキだったり、カーネル問を中心に作ってくれていて、userlandの問題が欲しいなと思ったので、易しめのカスタムvm問を目指した。（好きなので）
    - 反省点が多くて、まずびびってソース出さなかったことがだめ。もう1つは、カスタムvm問はreverseとセットで出すべきなのにreverse問が出なかったことがだめ。
        - 前者はカスタムvm問はその解析範囲がいやでも広がるため、楽しんでもらうなら必須だった。
        - 後者は部分点を与えたり、とっつきやすくするため。reverse問は実は直前に用意しようとしてたけど、インプットが短めでまともなプログラムが書けないので、stagerを加えて、固定アドレスにコードを展開して飛んで、簡単な処理をさせてフラグチェックをするようなのを考えていて、しかしジャンプが相対アドレスだったのでstageに飛べず。今更バイナリ側を変える時間もなかったので諦めました。ご利用は計画的に。とは言え一週間毎日１時間くらい時間使ってたので、作問にそもそも時間が読めないところはある。普段から作る習慣あっても良さそう。検証作業の延長として。

### saarctf2021
- (5/8) AD系のCTF初めて参加して深夜に無の生成にいそしむ。チームはすごく丁寧にツールを用意していて、貢献したい気持ちがいっぱいだったが6502のリバースが全くできずに終わった。

### その他復習
- (5/19) picoctf2021のブラウザ問復習に戻る。カンニングしながらでも上手くいってない。
    - (5/20) オフセットちゃんと見たら通った？構造体にはelementへのポインタがあるけど、この時elementの実体が構造体からの固定オフセットにいるというのがポイントっぽい。あとAAWでなんで素直にちまちま書いていかないのという疑問は、書きたい先のrwxがポインタ圧縮の範囲内にないからということ。だからbacking_storeでデータを保持している構造体ArrayBufferを別に用意して、そこをrwxのアドレスに差し替えることで、ポインタ圧縮の範囲外に書き込みをすることができるという理屈っぽい
    - このexploit、なぜかシェルコード入れ終わって完成した瞬間、ファイルそのものがI/O errorで読めなくなったんですが、もう一回書けってことかな。パソコンまだ新しいんだけどな
    - (5/21) なんか読めるようになったので終わった。次の問題を落としている間にpicominiの新しい問題をさばいてた。シェルコード問がおおい。
- (5/23) picominiのhomework、vm問。プログラムカウンタが二次元になってるスタックマシン的なもの。スタックの値の交換をxor3回でやっててすごい。きっと当たり前も当たり前なんだろうけど、a=a^b; b=a^b; a=a^bで交換できる。
    - (5/26) ようやく解けた。boardに書き込む"p"コマンドが下のほうがはみ出てて、メタデータを変えられる。colを大きく書いて範囲制限を壊して、直下のフラグを'g'でロードして','で出力しながらインクリしていく。スタックマシンで直値を入れられない、スワップを任意のインデックスとやる方法がないのでループ作るのが少し難しい。
- (5/28) picoctf2021の最後のブラウザ問を見ている。turbofanの記事をとりあえず眺めてメモってを繰り返している。小数まるめ誤差とかで加算結果ががばがばになってるのを利用して投機的なコンパイルがおかしくなるみたいなのは理解できたけど、でっていう段階。色々なバグについていろいろな記事があっておもしろい。

### その他
- (5/3) defconやりたかったね。つらいね。
- (-5/7) 隙間時間で作問チャレンジしてる。間に合えば来週末に投下するかも。
- (5/14) 問題が完成。ぎりぎり間に合って良かった。
- (5/31) htb埋めもちまちま進め中。久々にめんどくさそうなheap問触ってるため、いろいろと忘れたことに気づく。
- (6/1) 今更気づいたけどこれは特に公開する必要ない気がするな。時間があるなら個々を膨らませて記事化する方に使ったほうが建設的っぽい。