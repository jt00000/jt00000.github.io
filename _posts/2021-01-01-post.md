---
layout: page
title: "1月まとめ"
date: 2021-01-01 00:00:00 -0000
---
### justctf
- 1問も解けず。
- pwn qmail: メールフォーマットが入って終わりのもの。subjectとか本文にfsbがあるんだけど、インタラクティブにならない＋stdinはshotdownする必要がある。リーク何回か試してみたけど、たぶんaslrは切られている気がしている。がどちらにしてもそのあと何すればいいかわからんかった。シェル開いたとして、操作できるのかな
    - ガジェットはadd rsp系でやればよくて、orw用の人たちはバイナリにあるためリークはいらず。できないとだめ

### 0x4141ctf
- pwnはぜんぶとけた
    - moving signal: writeでスタックアドレスリークしてシェルコード
    - external: bofがあってgotがワイプされる。戻してret2csu
    - the pwn inn: 忘れたfsbのなんか
    - return of the rops: ret2mainやるだけ
    - faking till youre making: stackにフェイクチャンクを作って書き換え
    - echo: retスレッド→environの頭らへんパーシャルライトでスタックに戻す。確率低め。これ点数下がってたけど一番難しかった。
        - これubuntu20で解析してたんだけど、NX無効になってんのにrwx領域がなくて、バージョン落としたら出てきた。不思議。とりあえずchecksecを信じて、おかしかったらOSのバージョンを下げる。
- revも全部解いたけどほぼバイナリ改変していく謎問ばっかりだった。後半はgoで書かれてた。追加の１問はよくわからなかった
- revのcliBrouwserだけは面白くて、サーバにjwt形式のトークンをもらいに行くんだけど、バイナリのメニューに隠しコマンドがあって鍵を出力してくれるのでjwtを改ざんしてflagのクエリを投げるという手順。これもgoだった。go見るのつらい

- このCTFはユーザ登録をするためにPINが必要で、それがサイトのロゴの2枚のgifのうちの１枚の末尾に書かれている、という問題が一番難しかった。やる意味ないと思うんだよなあこういうの

### bamboofox
- babystack: mainの最後でstdoutが切れる。リークはlibcはでなさそうだけど、syscallがあるのでうまいことループを作ってpivotしてやってみたけど、execveが落ちる。ブラインドでopen readしてmemcmpに飛ばしてっていうやつも試してみたんだけど、なぜか安定せず。
    - gotにplt書いたら、書いた値が出るだけと思ったけど、たとえばその直後に使われる関数だったり、リークする主体（このケースだとputsそのもの）はアドレス解決してるからgotのlibcアドレスが復活している。というのが知見。あとsystemで起動したらexec 1>&0で行けると思ったんだけど、自分で作ったらなぜか刺さらない。
    - もうちょっとやったら結局、rspがもとのstackのセグメントをさしてないとダメっぽい？do_systemの下で__spawni→__spawnixと呼ばれるんだけど、関数の先頭で`sub rsp, xxx; mov qword ptr[rsp+xxx], rdi`みたいなことやって落ちてよくわからない。そこにポインタがあるのisなぜ。とりえあずpivotしてrop作った後はスタック戻してあげると刺さる。セグメント内でenviron壊してなければどこでもよさそう。stdoutの復帰は`exec 1>&0`か、writeupは`system('sh 1>&0')`としていた。
    - さらにもう少し、rspが元のstackにいることというよりは、environのポインタがあればいいみたい。pivotしてても`execve('/bin/sh', 0, environ)`でうまくいった。逆にbssにpivotした状態でsystemを撃ってもだめ。勉強になり申した。

- ropot: ソースありpartial gotでpieリーク済み。子プロセスからread writeだけのくそながropを書いて、親プロセスのシェルを立ち上げる。子プロセスで最初のreadを呼ぶときにアドレス解決しに行ってスタック食いまくって死ぬんだけど、

### *ctf2021
- babyheap: チャンク+8が編集できる、uafになってる、0x400mallocが一回だけできる、通常時の確保サイズは0x10~0x60まで、tcacheのkeyを変えるとdouble freeはできるものの、結局fdを変えられないのでどうしていいのかわからんかった
    - 当然1度だけできる0x400のmallocがポイントで、fastbinでそれを超える大きさで散らかしてから0x400mallocするとconsolidateが走ってoverlapして終わる。意外と知らんね。実装見るべしっていう話なんだけど、狙って見れないからこういうのが助かる
    - ちなみに問題は更新版libc2.27だったけど、libc2.31でもできた

### その他
- 12/31にメインノートが故障。vaioのロゴが出なくなって完全に終わったため、いろいろ調べたり試したりしたけど上手くいかず。5,6年くらい使っているのでまあそんなもんかと、次の購入を決意。PCもいろいろ考えたけど結局vaio買いなおした。
    - 買いなおしたら古いやつが動いた。息子氏に渡したら狂ったように叩いてたけどそれで直ったっぽくて草。とはいえSSD抜いちゃったので、とりあえず放置してそのうち持ち運び用にでもしようかな。

- 納品が1/14なんだけど、それまでに作業していたSSDのサルベージをすべくSSDを外付けにするやつ頼んだら、配達記録がされてないのに届けられなかったことになって、勝手に返金手続きされてて謎。
    - これようやく届いたけど、サブで使ってるPCがUSB3.1に対応していないため認識してくれず積んだと思ってたけどraspberrypiは認識できたので無事サルベージ成功。
- 弊チーム活動休止っぽい。もともとまともに稼働してたのは俺含めて2人だったので、2年ようがんばった。相方に感謝。どっか呼ばれれば行きたいけど自分から立ち上げ直すモチベはないなあ。特にあてもないし。何も変わらず参加はし続けると思う。
- netwars前から気になってたんだけど、今年は学生以外も良いそうなので応募してみた。PCの要件がwindows10でVM使えてメモリが16GBでとか書いてあって、納品されるPC頼みになってて投機的。
    - 届くまで完全に環境がないので、どちゃくそ古いＰＣでRaspberrypi叩いたりgitサーバ立てたりアンドロイドアプリのチュートリアルやったりした

- 新PCのリハビリがてら、pwn.tn（https://pwn.tn/）のpwn5問解いた。ちょい前にどこかで見たネタが並んでて復習にちょうどよい
- 某A省のあれ応募した。やべえ評判だけどどうなるかな。