---
layout: page
title: "３月まとめ"
date: 2020-03-03 00:00:00 -0000
categories: pwn, other 
---

### Aero2020
- (3/1)Pwn4問。久々にガッツリ解けたけど後1問残ったし、残ったやつ凡ミスすぎて悔しい。
    - plane_market: tcache poisoning. 終端null処理しない＋uaf＋任意サイズmallocがあるので、0x420をfreeしてリーク→free hookにsystemを乗せるだけ。
    - shell me if you can: シェルコード＋追加の命令コードで、いろいろ邪魔されるやつ。命令コードはRSLCの4つでそれぞれ条件があって一部をnopに差し替えたり、読み出し開始位置をずらしたりする。解析した結果、アルファヌメリックシェルコードが刺さることを確認したのでそのまま投げた。
    - ticket_storage: かなりの謎問だった。フラグがヒープの固定オフセットに最初に読み込まれるが、チケットIDが不明な状態になる。7回チケットを登録するとheapのアドレス一覧がBSSに移されて、検索機能が使えるようになる。一覧の一番最初の8バイトは名前を変更するところと重複しているので、ヒープリークしてflagのアドレスを特定した後に、名前のアドレスにflagのアドレスを持つ偽チケット構造体を作って、重複しているところにそのアドレスを入れて、偽チケット構造体のチケットIDで検索するとフラグが読める。
    - 32bitでfcloseを何とかする問題。ファイルストリームのポインタが雑に扱われるのでかなり簡単にわかったが、fcloseからなんとかするのが久々すぎてだいぶ詰まったし、最後引数のところに制約が入ってしまって上手く行かなかったので、ヒープにpivotしてropしたらprintfでスタック奪われすぎて危うく成功しないところだった。別にそんなことしなくていいらしい。雑すぎた。これが解けたんだけどリモートで刺さらなくて諦めて、あとでもっかい繋いだら行けた。最初からちゃんと設定して欲しいという気持ちと、そういう設定に不備があってもフラグを通しちゃうやばい人間がいるという普通の感動の気持ちがある。
    - passkeeper: これが解けなくてずっと悩んでた。bssにfpがあって、その隣が名前のアドレスなのでサイズつけてやってfreeしてtcache poisoningするだけの問題で、id管理にoff-by-one的なのがあるのは分かってたけど、free上手く行かないなって何故か誤解したまま進めててどえらいことになってた。ほんとうにカス。
### zer0ptsCTF2020
- (3/7-3/8)ほぼ全ての時間を使えた。家族に感謝。pwnは１問しか解けなかったがおもしろかった。
    - qr puzzle: 戻すだけ。元のプログラムに鍵逆にしたやつ入れてもOKなのは確かにそうだけど気づかなかった。
    - ror: 下位１ビットにフラグが漏れる
    - vmlog: １文字単位のブルートフォース
    - easy strcmp: strcmpが改ざんされてから飛ぶようになっている。１文字単位のブルートフォース
    - hobbit: データセクション覗いてたらそれっぽい文字列があって、適当にxorしてみたら解けてしまって申し訳ない気持ちでいっぱい。バイナリ自体が暗号化されていたらしい。要復習
    - babybof: これ非想定っぽい。まずbss ropでstderrをrbpにセットして、readの手前に飛ぶ。これでもう１度leave retするとstderrの中を編集できる。アドレス的に下のstdoutのwriteポインタをいじりつつ、壊れたstderrでropを作って、fsopをmainに向けて今度はsetupに飛ぶ。するとstdoutのsetbufでリークし、stderrのsetbufでmain関数内部に戻れるので、後は普通のropを作って終わり。100%刺さるぞ。むちゃくちゃきれいに解けた。
    - shredder: coreをghidraに入れて、アルゴリズムを見つけた後にheapに残ったpdfをがちゃったやつと、スタックから値を引っ張り出してきて復号した。おもしろかった。

### 常設
- (3/4)glibc2.23で__free_hookに書き込むやつ復習した。結局unsortbinに２つチャンクをためた後で、１つ目のfreeチャンクのbkを書き込みたいところに変えると、次にぴったりのサイズでallocしたときにそこにmain_arenaのアドレスが書き込まれる。これが2.29だと、前に復習したとおりbkと、bk先のチャンクのfdがお互いを指しているかの確認が入るという理解で正しいはず

### 競プロ
- (3/1)abc157、Cまで。Dが問題の意味がわからない。グラフが繋がってないところを数えたらいいんじゃないの。何も分からん。
- (3/3)abc157のD復習。意味が分かってから問題文を読むと理解できる。Union Find Tree使った。(10^5)^2の配列は落ちる。このあたりのサイズ感も掴めると良い。