---
layout: page
title: "11月まとめ"
date: 2020-11-01 00:00:00 -0000
---
### hitcon
- pwn１つだけとけた。まじで何もわからんかった。カーネル問やってないとメチャにぶるなあ。ただ、pwnいっぱいあるctfは好き。
    - baby shock: シェルjail`pwd ; whoami`みたいなのできて、環境変数変えられるんだけどスラッシュとメタ文字ほぼ全てが禁じられている。インタラクティブ系のコマンド(viとかshとか)もなんか上手く行かない
        - 上手く行ってて、`pwd ; vim`とかだと後ろでプロセスが残ってくれるのでexitを打ってからシェルを起動できる。revengeは `id () (vim)`で行けるらしい。これも中括弧じゃないとダメだと思ってた。そもそもなんでviだとダメなのかわからん。とりあえずだめ
    - 唯一解けたdualはグラフ管理でそれぞれのノードがデータを貯めるところを持っていて、ガベコレでfreeする。これは、根っこから探索しながらマークをつけて、つかなかったチャンクは接続していないからfree、という実装になっている。ところがwrite_binでサイズを０にしたとき、空っぽのプールを指しちゃっていて、次の確保で２重に指されるような状態になる。ここから利用方法をしばらく考えてたんだけど、結局探索ってマークを見つけたらその下は見に行かない仕様になっているから、偽ノードにしておいて、下にノードをぶら下げておけば、先にマークがついて、探索する頃には打ち切られてしまい、ノードがあるのにfreeされる。あとはノードのふりしたチャンクを作ればuafが完成してただガチャガチャやってるだけで解ける。結構ぱっと見きつそうなところからsubmitまで持っていけたのはかなり嬉しい。

### wanictf
- 個人初の全完。さすがにcrypto埋めれんだろうと思いながらやってたら埋まってた。わりと調べたので賢くなった。
    - lcgは結局記事を見つけて終了（https://tailcall.net/blog/cracking-randomness-lcgs/ ）要するに法が分かると、出力差分からaとcが分かる→法は法の倍数同士のgcdで高確率で出てくる→法の倍数を漸化式を使って作る。という流れ。みんなスラスラ解いてたから何事かと思ったら、数字を入れないとフラグが出ちゃうとかいうバグがあったらしい。ソースコードちゃんと読むべし。とはいえcryptoだからそういうソースの読み方はしてなかったのでﾖｼ
    - complexは戻りが2なら通すので、mov eax,2のバイトコードを探して、そこの文字チェックを持ってきた。
    - heapはなんか想定解法free_hookとからしいけど、だったらno pie、partial relroはいらなかったのでは？tcache書き換えて管理チャンクの上を取って、aarw作ってgot読んで書いて終わってしまった。ついでに2.27なのにdouble freeできなくなってて不思議
### dragon2020
- すみませんwriteupまちです。
    - no-eeeemoji: 0ctfのeeeemojiとセットアップが似てるけど文字列は絵文字じゃなくて、普通のバイトで入れられる。レジスタ全滅＋2バイトガジェットでどうするのかな。1solveがクソ早かったのが気になる。
        - 最近流行りのvdso周りを使うらしい。すごいなvdso。思考の隅にはあったけど、ip変えられるほどの能力があるとは思ってなかった。改題系は元の問題に思考が引っ張られて脳が一層働かないので苦手。

    - heap-hop: 去年?のtsgにあったssbみたいな管理チャンクと、独自にheapっぽいデータ管理するやつがあって、出力がidしかない。ただidはallocされたチャンクの順番に振られるので、うまいことリーク値がidのところに割当たれば、idの増減からリークすることができる。ただしmallocが最低サイズ0x610で、libcリークしたはいいけど2.31でunsortbin attackはそのまま使えないため、詰み。
        - これは解けないとだめ。デカチャンクはlibcに隣接するので、隣接させて、ヘッダ書き換えてfree_hookを書く。が正解。こういう抜けを無くすような仕組みを作らないとダメだ。アイデアはあるが手間がかかる。

### layer7
- vm pwnだけ解いた。自作スタックから自作レジスタへのmov関数があって、当然movなのでスタック管理がガバガバで何も制限なく終わった。

### balsn2020
- 去年もだけどpwnの一番簡単なやつだけも解けなかった。典型heapノート問で、editに負数が入る＋ヒープリークとめちゃくちゃ簡単そうに見えるのに、リークなしでstdoutを触りに行くのが想定解っぽい。すごい。みんな解けてる。みんなすごい

### kipod2020
- pwn / chip-8: 小さい仮想マシンのエミュレータ。リファレンスいいのがあった。http://devernay.free.fr/hacks/chip8/C8TECH10.HTM#00E0
    - 多分普通の部分は実装していて、jitに放り込んでごにょってるところにまずいのあるんだろうけど誰も解いてなかった
- pwn / shadow stuckは自作シャドウスタックなんだけど実装がゆるいパターン。ついでに序盤配布されてたバイナリはフリーリストの実装にもバグがあって、解析パートがはしょれた。さぼり

### sunshine
- speedrunしばいてたら終わった。lilchompyは色々リークするところまでは上手く行くけど、任意アドレス書き込みがようわからんかった。最後submit関数使うのかと思ったらまさかのインデックスここだけ防御されてて時間切れました。
    - 調子よく解析サボりながらリークできたのが悪くて、ちゃんと最初の段階でヘッダをbssに仕込む、が正解でした。

### nactf2020
- なんかようわからんけど連休で色々旅行しながらめっちゃ解いた。revのvm問楽しかったけど、ソート前の文字列見てから、最初の数操作で３文字飛ばしで文字取ってるの見つけちゃってコード書かずに済んじゃった。

### cybersecurityrumble2020
- pwnかんたんなの３問とけた。qemuコンソールからのfs部分のリークをする問題がわからんかった。
    - unhackableはqemuのコンソールに切り替えて物理メモリをセーブするのが正解。コマンドは `pmemsave 0 0x10000000 hoge.bin`から端末で`strings`とかでオフセットサーチして、再びqemuで`xp offset`と入力すると、対応する物理アドレスのメモリが出てくる。`xp`はgdbにあるコマンドかと思ったらqemuのコマンドだった。`x`だと仮想アドレスが出る。

### その他
- 社内の常設埋めはようやく１２０問あたりに到達。わからん問題は何人解いてようがわからんというのが辛いところ。苦しくなってきた
- 去年のcodeblueのlineのctfにvm問があって、それが解けた。1年ちょっとたったけどようやく解けた。命令列が偶数番目にいるか、奇数番目にいるかで挙動が変わるというのが癖があって理解しにくかった。バグはsecconのvm問に似ていて、バッファの終端に範囲を超えて書き込めるところがあって、そこから管理チャンクを書き換えられるというもの。no-pie, partial relroなので後はexitやfreeを狙ってループとリークを作って行く。