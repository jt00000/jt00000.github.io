---
layout: page
title: "２月まとめ"
date: 2020-02-14 00:00:00 -0000
categories: pwn, rev, other 
---


### hacktm2020復習
- (2/7)twistyのパズルソルバ組めた。
- 3行目まで素直に詰めていって、４行目の左を決めてから、残り３つの順列で６通りを場合分け。（うち１つがクリア）
- 例えば1234が揃ってる行、ABDCが1つ入れ替わっている行として、以下のように最終行の任意の１つを入れ替えられる。
```
1234    1D34    1234
ABDC -> A2BC -> DABC
```
こんな感じで5パターンそれぞれベタがきして終わり。競技時間はここの６択の解消がわからず手動でやって、えらい時間かかってしまった。

### nullcon2020
- (2/8, 9) revの簡単なやつと、unsortbin attack使う懐かしいやつ解いた。printf問は今回も分からんから捨てて、他の人が解いたので要復習。
- chocochipも簡単そうなのに解けなかったのでやる。あとcryptoの簡単なやつも。そろそろcrypto詰めたいな。
- (2/11) rpsを復習。hashて書いてんのに順番入れ替えてるだけだったので戻してがんばるタイプ。revって書いてれば解けてたかも。

### 常設
- glibc2.23, fastbin dup、malloc_hook上書きからのone_gadget。スタック状況が悪い時にどうするか。
    1. `call realloc`からの`realloc_hook`でごまかすっていうの、2.27のアラインメント対策によく使われるやつを試してローカル○、リモート☓
    2. なんとdouble freeからmallocが呼ばれる。条件がよく分からない。(参考：https://blog.osiris.cyber.nyu.edu/2017/09/30/csaw-ctf-2017-auir/)
        - ソース見ながら追ってみたけど、`malloc_printerr`でエラーの表示を初めて、`dlopen`とかでエラー文を作っていく中で呼ばれる`strdup`でmallocが呼ばれているとのこと。実際に見た。
        - ただローカルでのみ再現しない。環境の問題っぽい。なにこれ
    3. そもそもunsortedbin attackからfree_hookをさわれるパターンがあるらしい。2.23のfree_hookってheap無限に書けるパターン以外知らなかった。要調査。
- (2/14)hack the boxの本編の方やった。ツールが大変そう。80番が空いていて、そこからパスのサーチやったりするのとか、ファイルの中のパスワードを探す作業とか。あと、カーネル問が上がってたので解いたけど、リモート環境繋がってる気がしなくて、俺が悪いのか、なにか儀式があるのかを把握できていない。初カーネル問サブミットの道のりは長い。

- (2/17)カーネル問解けた。リモートでちょっと設定変わっててだるいだけだった。それならいっそもう毎回値変えればって思う感じのやつ。一番きついのが、インスタンスが１０回に１回まともに応答あるやつが起動できるという状態。たまたま応答が来てなかったら今もリモート接続前で止まってた。こわいこわい

- (2/19)時間があるので１dayのやつやる。CVE2018-1160のafpd。立ち上がらないので環境から。別記事でまとめながら。
- (2/21)heap、rwx問２つ。短距離の相対ジャンプは２バイトでできる。`\xeb\x20`で"jmp 0x22”になる。
- (2/22)glibc2.29のconsolidateについて。prev_sizeを確認するようになったので、サイズがずれていると落ちるようになっている。チャンクのサイズを改ざんするか、ぴったりサイズのfake chunkを入れる必要がある。過去問解いて記事書いて整理。
- (2/25)2.29のconsolidateの常設解けた。docker上のxinetdでheapがずれるのは環境再現できたけどまじで謎。すごいのが、先頭がずれるだけじゃなくて、なぜかexploitの後ろの方でもさらに補正が必要だったこと。オフセットとゎ。初seccompバイパス作品かもしれん。

### 本

### 競プロ
- (2/9)abc154は2問止まりで大爆死。死因は１．YesとYESを間違える。２．小数点以下の誤差を無視して組む。(`printf("%.6lf\n", xxx)`が正解）E以降は分からんので蟻を進めるべき。
- このゲーム、どこで間違えても終了後すら何ミスか一生わからないの相当ストレスになってる。競技終わってからくらい、どういう数字が出るべきで、俺の出力がどうなってるのかは欲しいな。コーナーケース対応のために人のコード読みたくないわ。
- (2/16)abc155、またABだけ。Cは連想配列でpythonに甘えたらTLE、Dは２分探索だったらしいところをきれいに全数探索してこれもTLE、E以降はさっぱり。とりいそぎ連想配列をcppでやる。
- (2/20)c復習。ソートが要ると思っていたが、cppの連想配列は勝手にソートされているらしい。また初期化も無かったけど通った。
